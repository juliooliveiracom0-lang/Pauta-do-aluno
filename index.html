<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pauta do Aluno (Hilário Morais) - App Profissional</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  /* Tema profissional estilo app Android/iOS */
  body {
    font-family: 'Roboto', sans-serif;
    margin:0; padding:0;
    background:#f5f5f5; color:#333;
  }
  h1 {
    text-align:center; background:#6200ea; color:white; padding:15px 0; margin:0;
    font-size:1.5em; box-shadow:0 3px 8px rgba(0,0,0,0.3);
  }
  .container {
    max-width:520px; margin:20px auto; background:white;
    padding:15px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.2);
    transition:0.3s; overflow:hidden;
  }
  .container:hover { transform:translateY(-3px); }
  input, select, button {
    padding:12px; margin:5px 0; width:100%;
    font-size:16px; border-radius:10px; border:none; box-sizing:border-box;
    transition:0.2s;
  }
  input, select { border:1px solid #ccc; }
  input:focus, select:focus { border-color:#6200ea; outline:none; box-shadow:0 0 5px #6200ea; }
  button {
    background:#6200ea; color:white; cursor:pointer; font-weight:bold;
  }
  button:hover { background:#3700b3; }
  table { width:100%; border-collapse: collapse; margin-top:15px; font-size:14px; }
  th, td { border:1px solid #ddd; padding:8px; text-align:center; transition:0.2s; }
  th { background:#6200ea; color:white; }
  td input {
    width:50px; text-align:center; border-radius:5px; border:1px solid #ccc;
    transition:0.2s;
  }
  td input:focus { border-color:#6200ea; box-shadow:0 0 5px #6200ea; outline:none; }
  .btn-small { padding:5px 10px; font-size:12px; margin:2px; border-radius:6px; transition:0.2s; }
  .btn-edit { background:#ffb300; color:white; }
  .btn-edit:hover { background:#ff8f00; }
  .btn-delete { background:#d32f2f; color:white; }
  .btn-delete:hover { background:#b71c1c; }
  canvas { margin-top:20px; width:100% !important; height:230px !important; border-radius:10px; }
</style>
</head>
<body>
<h1>Pauta do Aluno (Hilário Morais)</h1>

<div class="container" id="loginContainer">
  <h3>Login / Registro</h3>
  <input type="text" id="alunoNome" placeholder="Nome do aluno">
  <input type="password" id="alunoSenha" placeholder="Senha (opcional)">
  <button onclick="loginAluno()">Entrar / Registrar</button>
</div>

<div class="container" id="appContainer" style="display:none;">
  <h3>Bem-vindo, <span id="nomeAluno"></span></h3>

  <h3>Adicionar Disciplina</h3>
  <input type="text" id="disciplinaNome" placeholder="Nome da disciplina">
  <input type="color" id="corDisciplina" title="Escolha a cor da disciplina">
  <button onclick="adicionarDisciplina()">Adicionar Disciplina</button>

  <h3>Adicionar Nota</h3>
  <select id="disciplinaSelect">
    <option value="">Escolha uma disciplina</option>
  </select>
  <input type="number" id="notaValor" placeholder="Nota (0-20)" min="0" max="20">
  <button onclick="adicionarNota()">Adicionar Nota</button>

  <h3>Notas por Disciplina</h3>
  <div class="scrollable">
    <table id="tabelaNotas">
      <thead>
        <tr>
          <th>Disciplina</th>
          <th>Notas</th>
          <th>Média</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <h3>Evolução das Médias</h3>
  <canvas id="graficoMedias"></canvas>

  <button onclick="exportarPDF()">Exportar Boletim em PDF</button>
  <button onclick="logoutAluno()">Sair</button>
</div>

<script>
const { jsPDF } = window.jspdf;
let alunoAtual = null;
let alunosData = JSON.parse(localStorage.getItem('alunosData')) || {};

// LOGIN
function loginAluno(){
  const nome = document.getElementById('alunoNome').value.trim();
  const senha = document.getElementById('alunoSenha').value;
  if(!nome) return alert("Digite seu nome.");
  alunoAtual = nome;
  if(!alunosData[alunoAtual]) alunosData[alunoAtual] = { senha:senha, disciplinas:{} };
  else if(alunosData[alunoAtual].senha !== senha) return alert("Senha incorreta!");
  salvarLocalStorage();
  document.getElementById('loginContainer').style.display='none';
  document.getElementById('appContainer').style.display='block';
  document.getElementById('nomeAluno').textContent = alunoAtual;
  atualizarInterface();
}

// LOGOUT
function logoutAluno(){
  alunoAtual = null;
  document.getElementById('appContainer').style.display='none';
  document.getElementById('loginContainer').style.display='block';
  document.getElementById('alunoNome').value='';
  document.getElementById('alunoSenha').value='';
}

// SALVAR
function salvarLocalStorage(){ localStorage.setItem('alunosData', JSON.stringify(alunosData)); }

// DISCIPLINA
function adicionarDisciplina(){
  const nomeDisc = document.getElementById('disciplinaNome').value.trim();
  const cor = document.getElementById('corDisciplina').value || "#6200ea";
  if(!nomeDisc) return alert("Digite o nome da disciplina.");
  const aluno = alunosData[alunoAtual].disciplinas;
  if(!aluno[nomeDisc]){
    aluno[nomeDisc] = { notas:[], cor:cor };
    salvarLocalStorage();
    atualizarInterface();
    document.getElementById('disciplinaNome').value='';
  } else alert("Disciplina já existe.");
}

// ATUALIZAR INTERFACE
function atualizarInterface(){
  const select = document.getElementById('disciplinaSelect');
  select.innerHTML = '<option value="">Escolha uma disciplina</option>';
  const aluno = alunosData[alunoAtual].disciplinas;
  for(let nome in aluno) select.innerHTML += `<option value="${nome}">${nome}</option>`;
  atualizarTabela();
  atualizarGrafico();
}

// NOTAS
function adicionarNota(){
  const disciplina = document.getElementById('disciplinaSelect').value;
  const nota = parseFloat(document.getElementById('notaValor').value);
  if(!disciplina) return alert("Escolha uma disciplina.");
  if(isNaN(nota)||nota<0||nota>20) return alert("Nota inválida!");
  alunosData[alunoAtual].disciplinas[disciplina].notas.push(nota);
  salvarLocalStorage();
  atualizarInterface();
  document.getElementById('notaValor').value='';
}

// TABELA INTERATIVA
function atualizarTabela(){
  const tbody = document.querySelector('#tabelaNotas tbody');
  tbody.innerHTML='';
  const aluno = alunosData[alunoAtual].disciplinas;
  for(let nome in aluno){
    const disciplina = aluno[nome];
    const notas = disciplina.notas;
    const media = notas.length ? (notas.reduce((a,b)=>a+b,0)/notas.length).toFixed(2) : "-";

    const notasHtml = notas.map((n,i)=>`<input type="number" value="${n}" min="0" max="20" style="border-color:${disciplina.cor}" onchange="editarNota('${nome}',${i},this.value)">`).join(' ');

    const acoes = `<button class="btn-small btn-delete" onclick="deletarDisciplina('${nome}')">Excluir Disciplina</button>
                   <button class="btn-small btn-delete" onclick="deletarNotas('${nome}')">Excluir Notas</button>`;

    tbody.innerHTML += `<tr>
      <td style="background:${disciplina.cor};color:white;">${nome}</td>
      <td>${notasHtml}</td>
      <td>${media}</td>
      <td>${acoes}</td>
    </tr>`;
  }
}

// EDITAR NOTA INLINE
function editarNota(disciplina, indice, valor){
  const nota = parseFloat(valor);
  if(isNaN(nota)||nota<0||nota>20) return alert("Nota inválida!");
  alunosData[alunoAtual].disciplinas[disciplina].notas[indice] = nota;
  salvarLocalStorage();
  atualizarGrafico();
}

// DELETAR NOTAS
function deletarNotas(disciplina){
  if(!confirm("Deseja realmente excluir todas as notas desta disciplina?")) return;
  alunosData[alunoAtual].disciplinas[disciplina].notas = [];
  salvarLocalStorage();
  atualizarInterface();
}

// DELETAR DISCIPLINA
function deletarDisciplina(nome){
  if(!confirm("Deseja realmente excluir esta disciplina?")) return;
  delete alunosData[alunoAtual].disciplinas[nome];
  salvarLocalStorage();
  atualizarInterface();
}

// GRÁFICO
let chart;
function atualizarGrafico(){
  const aluno = alunosData[alunoAtual].disciplinas;
  const labels = Object.keys(aluno);
  const medias = labels.map(nome=>{
    const notas = aluno[nome].notas;
    return notas.length ? (notas.reduce((a,b)=>a+b,0)/notas.length).toFixed(2) : 0;
  });
  const cores = labels.map(nome=>aluno[nome].cor);
  const ctx = document.getElementById('graficoMedias').getContext('2d');
  if(chart) chart.destroy();
  chart = new Chart(ctx,{
    type:'bar',
    data:{ labels, datasets:[{ label:'Média', data:medias, backgroundColor:cores }]},
    options:{ responsive:true, maintainAspectRatio:false, scales:{ y:{ beginAtZero:true, max:20 } } }
  });
}

// EXPORTAR PDF
function exportarPDF(){
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text(`Pauta do Aluno (Hilário Morais)`,20,20);
  doc.setFontSize(14);
  doc.text(`Aluno: ${alunoAtual}`,20,30);
  let y=40;
  const aluno = alunosData[alunoAtual].disciplinas;
  for(let nome in aluno){
    const disciplina = aluno[nome];
    const notas = disciplina.notas.join(", ");
    const media = disciplina.notas.length ? (disciplina.notas.reduce((a,b)=>a+b,0)/disciplina.notas.length).toFixed(2) : "-";
    doc.setTextColor(disciplina.cor);
    doc.text(`Disciplina: ${nome}`,20,y);
    doc.setTextColor(0,0,0);
    doc.text(`Notas: ${notas}`,20,y+7);
    doc.text(`Média: ${media}`,20,y+14);
    y+=25;
  }
  doc.save(`Pauta_${alunoAtual}.pdf`);
}
</script>
</body>
</html>